
# 支持的模型列表

<cite>
**本文档中引用的文件**
- [LSTM](file://qlib/contrib/model/pytorch_lstm.py)
- [GRU](file://qlib/contrib/model/pytorch_gru.py)
- [Transformer](file://qlib/contrib/model/pytorch_transformer.py)
- [GATs](file://qlib/contrib/model/pytorch_gats.py)
- [TCN](file://qlib/contrib/model/pytorch_tcn.py)
- [LightGBM](file://qlib/contrib/model/gbdt.py)
- [XGBoost](file://qlib/contrib/model/xgboost.py)
- [CatBoost](file://qlib/contrib/model/catboost_model.py)
- [DoubleEnsemble](file://qlib/contrib/model/double_ensemble.py)
- [workflow_config_lightgbm_Alpha158.yaml](file://examples/benchmarks/LightGBM/workflow_config_lightgbm_Alpha158.yaml)
- [workflow_config_xgboost_Alpha158.yaml](file://examples/benchmarks/XGBoost/workflow_config_xgboost_Alpha158.yaml)
- [workflow_config_catboost_Alpha158.yaml](file://examples/benchmarks/CatBoost/workflow_config_catboost_Alpha158.yaml)
- [workflow_config_lstm_Alpha158.yaml](file://examples/benchmarks/LSTM/workflow_config_lstm_Alpha158.yaml)
- [workflow_config_gru_Alpha158.yaml](file://examples/benchmarks/GRU/workflow_config_gru_Alpha158.yaml)
- [workflow_config_transformer_Alpha158.yaml](file://examples/benchmarks/Transformer/workflow_config_transformer_Alpha158.yaml)
- [workflow_config_gats_Alpha158.yaml](file://examples/benchmarks/GATs/workflow_config_gats_Alpha158.yaml)
- [workflow_config_tcn_Alpha158.yaml](file://examples/benchmarks/TCN/workflow_config_tcn_Alpha158.yaml)
- [workflow_config_doubleensemble_Alpha158.yaml](file://examples/benchmarks/DoubleEnsemble/workflow_config_doubleensemble_Alpha158.yaml)
</cite>

## 目录
1. [简介](#简介)
2. [GBDT系列模型](#gbdt系列模型)
3. [深度神经网络模型](#深度神经网络模型)
4. [集成学习方法](#集成学习方法)
5. [模型配置与超参数分析](#模型配置与超参数分析)
6. [Python API使用示例](#python-api使用示例)

## 简介
Qlib是一个专为量化金融研究设计的机器学习框架，支持多种先进的机器学习模型。本文档全面介绍Qlib支持的各类模型，包括梯度提升决策树（GBDT）系列、深度神经网络以及集成学习方法。通过分析examples/benchmarks目录中的YAML配置文件，我们将深入探讨各模型的关键超参数设置及其适用场景，并提供Python API调用示例。

## GBDT系列模型
Qlib集成了三大主流的GBDT实现：LightGBM、XGBoost和CatBoost。这些模型在处理结构化数据方面表现出色，特别适用于金融时间序列预测任务。

### LightGBM实现
LightGBM是一种基于梯度提升框架的高效实现，采用直方图算法和Leaf-wise生长策略，在保持高精度的同时显著提升了训练速度。在Qlib中，`LGBModel`类封装了LightGBM的核心功能，通过`lgb.train`接口进行模型训练。

**关键参数配置**
- `objective`: 损失函数类型，支持"mse"（均方误差）和"binary"（二分类）
- `num_leaves`: 叶子节点数量，控制模型复杂度
- `learning_rate`: 学习率，影响模型收敛速度
- `feature_fraction`: 特征采样比例，用于防止过拟合

**Section sources**
- [gbdt.py](file://qlib/contrib/model/gbdt.py#L0-L124)

### XGBoost实现
XGBoost是另一种广泛使用的梯度提升框架，以其正则化项和二阶泰勒展开而闻名。Qlib通过`XGBModel`类提供了对XGBoost的支持，利用`xgb.train`接口进行模型训练。

**关键参数配置**
- `eval_metric`: 评估指标，如"rmse"（均方根误差）
- `max_depth`: 树的最大深度，控制模型复杂度
- `subsample`: 样本采样比例，用于防止过拟合
- `colsample_bytree`: 每棵树的特征采样比例

**Section sources**
- [xgboost.py](file://qlib/contrib/model/xgboost.py#L0-L85)

### CatBoost实现
CatBoost专门针对类别型特征进行了优化，能够自动处理分类变量而无需预处理。Qlib中的`CatBoostModel`类封装了CatBoost的核心功能。

**关键参数配置**
- `loss_function`: 损失函数，如"RMSE"
- `grow_policy`: 树的生长策略，支持"Lossguide"
- `bootstrap_type`: 自举类型，支持"Poisson"

**Section sources**
- [catboost_model.py](file://qlib/contrib/model/catboost_model.py)

## 深度神经网络模型
Qlib支持多种先进的深度神经网络架构，特别针对时间序列数据进行了优化。

### LSTM网络
长短期记忆网络（LSTM）是一种特殊的循环神经网络，能够有效捕捉长期依赖关系。Qlib提供了两种LSTM实现：`pytorch_lstm`和`pytorch_lstm_ts`。

**网络结构特点**
- 多层LSTM堆叠，增强表达能力
- 支持dropout正则化，防止过拟合
- 使用Adam或SGD优化器进行训练
- 针对时间序列任务优化的数据加载器

**时间序列处理能力**
LSTM模型通过`TSDatasetH`数据集类处理时间序列数据，能够有效建模股票价格等时间序列的动态变化模式。

**Section sources**
- [pytorch_lstm.py](file://qlib/contrib/model/pytorch_lstm.py#L23-L282)
- [pytorch_lstm_ts.py](file://qlib/contrib/model/pytorch_lstm_ts.py#L24-L293)

### GRU网络
门控循环单元（GRU）是LSTM的简化版本，具有更少的参数和更快的训练速度。Qlib提供了`pytorch_gru`和`pytorch_gru_ts`两种实现。

**技术特点**
- 单一更新门机制，简化了LSTM的结构
- 在保持良好性能的同时减少了计算开销
- 支持多线程数据加载，提高训练效率

**Section sources**
- [pytorch_gru.py](file://qlib/contrib/model/pytorch_gru.py#L24-L315)
- [pytorch_gru_ts.py](file://qlib/contrib/model/pytorch_gru_ts.py#L25-L298)

### Transformer模型
Transformer架构通过自注意力机制彻底改变了序列建模领域。Qlib实现了基于PyTorch的Transformer模型，适用于长序列建模。

**核心优势**
- 自注意力机制能够捕捉序列中任意位置间的依赖关系
- 并行化训练，显著提升训练速度
- 适合处理长周期金融时间序列

**Section sources**
- [pytorch_transformer.py](file://qlib/contrib/model/pytorch_transformer.py)
- [pytorch_transformer_ts.py](file://qlib/contrib/model/pytorch_transformer_ts.py)

### 图注意力网络（GATs）
图注意力网络将注意力机制应用于图结构数据，能够有效建模股票间的关联关系。

**创新特性**
- 基于LSTM的底层编码器，结合图注意力机制
- 能够捕捉股票间复杂的非线性关系
- 支持预训练模型路径指定

**Section sources**
- [pytorch_gats.py](file://qlib/contrib/model/pytorch_gats.py#L25-L322)
- [pytorch_gats_ts.py](file://qlib/contrib/model/pytorch_gats_ts.py#L43-L334)

### 时间卷积网络（TCN）
时间卷积网络使用扩张卷积来捕捉长期依赖关系，具有稳定的梯度特性。

**架构特点**
- 多层扩张因果卷积堆叠
- 残差连接结构
- 支持不同内核大小和通道数配置

**Section sources**
- [pytorch_tcn.py](file://qlib/contrib/model/pytorch_tcn.py#L25-L295)
- [pytorch_tcn_ts.py](file://qlib/contrib/model/pytorch_tcn_ts.py#L24-L283)

## 集成学习方法
Qlib提供了先进的集成学习方法，其中DoubleEnsemble是其代表性实现。

### DoubleEnsemble多层融合策略
DoubleEnsemble采用两阶段集成策略，结合了模型选择和特征选择的优势。

**融合机制**
- 第一层：基于不同样本比例训练多个基础模型
- 第二层：通过加权组合生成最终预测结果
- 支持样本重加权（sample reweighting）和特征选择（feature selection）

**技术参数**
- `enable_sr`: 是否启用样本重加权
- `enable_fs`: 是否启用特征选择
- `bins_sr`: 样本重加权分箱数
- `decay`: 衰减因子，控制历史表现的影响

**Section sources**
- [double_ensemble.py](file://qlib/contrib/model/double_ensemble.py)

## 模型配置与超参数分析
通过分析examples/benchmarks中的YAML配置文件，我们可以深入了解各模型的关键超参数设置。

### GBDT模型配置对比
```yaml
# LightGBM配置片段
task:
    model:
        class: LGBModel
        kwargs:
            loss: mse
            colsample_bytree: 0.8879
            learning_rate: 0.2
            max_depth: 8
            num_leaves: 210
```

```yaml
# XGBoost配置片段
task:
    model:
        class: XGBModel
        kwargs:
            eval_metric: rmse
            colsample_bytree: 0.8879
            eta: 0.0421
            max_depth: 8
            n_estimators: 647
```

```yaml
# CatBoost配置片段
task:
    model:
        class: CatBoostModel
        kwargs:
            loss: RMSE
            learning_rate: 0.0421
            max_depth: 6
            grow_policy: