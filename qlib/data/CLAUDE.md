[æ ¹ç›®å½•](../../../CLAUDE.md) > [qlib](../../CLAUDE.md) > **data**

# æ•°æ®å±‚æ¨¡å—

> Qlib çš„æ•°æ®è®¿é—®ä¸å¤„ç†æ ¸å¿ƒï¼Œæä¾›ç»Ÿä¸€çš„æ•°æ®æ¥å£å’Œé«˜æ•ˆçš„ç¼“å­˜æœºåˆ¶ã€‚

## æ¨¡å—èŒè´£

æ•°æ®å±‚æ˜¯ Qlib çš„åŸºç¡€ç»„ä»¶ï¼Œè´Ÿè´£ï¼š
- ç»Ÿä¸€çš„æ•°æ®è®¿é—®æ¥å£
- å¤šç§æ•°æ®æºæ”¯æŒï¼ˆæœ¬åœ°/å®¢æˆ·ç«¯ï¼‰
- é«˜æ•ˆçš„æ•°æ®ç¼“å­˜æœºåˆ¶
- çµæ´»çš„æ•°æ®æ“ä½œç¬¦

## æ¨¡å—ç»“æ„

```mermaid
graph TD
    A["data æ•°æ®å±‚"] --> B["æ ¸å¿ƒç»„ä»¶"];
    A --> C["ç¼“å­˜ç³»ç»Ÿ"];
    A --> D["æ“ä½œç¬¦"];

    B --> B1["base.py - åŸºç¡€æŠ½è±¡ç±»"];
    B --> B2["data.py - æ•°æ®æä¾›è€…å®ç°"];
    B --> B3["client.py - å®¢æˆ·ç«¯è®¿é—®"];
    B --> B4["pit.py - ç‚¹å¯¹ç‚¹æ•°æ®"];
    B --> B5["filter.py - æ•°æ®è¿‡æ»¤"];
    B --> B6["inst_processor.py - å®ä¾‹å¤„ç†å™¨"];

    C --> C1["cache.py - ç¼“å­˜æŠ½è±¡"];
    C --> C2["ExpressionCache - è¡¨è¾¾å¼ç¼“å­˜"];
    C --> C3["DatasetCache - æ•°æ®é›†ç¼“å­˜"];
    C --> C4["DiskCache - ç£ç›˜ç¼“å­˜"];
    C --> C5["MemoryCache - å†…å­˜ç¼“å­˜"];

    D --> D1["ops.py - æ•°æ®æ“ä½œç¬¦"];
    D --> D2["ElementOps - å…ƒç´ æ“ä½œ"];
    D --> D3["SeriesOps - åºåˆ—æ“ä½œ"];
    D --> D4["ExpressionOps - è¡¨è¾¾å¼æ“ä½œ"];

    click B1 "./base.py" "æŸ¥çœ‹åŸºç¡€æŠ½è±¡ç±»"
    click B2 "./data.py" "æŸ¥çœ‹æ•°æ®æä¾›è€…å®ç°"
    click C1 "./cache.py" "æŸ¥çœ‹ç¼“å­˜æŠ½è±¡"
    click D1 "./ops.py" "æŸ¥çœ‹æ•°æ®æ“ä½œç¬¦"
```

## å…¥å£ä¸å¯åŠ¨

### ä¸»è¦æ¥å£
- **`D` å¯¹è±¡**ï¼šå…¨å±€æ•°æ®è®¿é—®å®ä¾‹
- **æ•°æ®ç±»å‹**ï¼š
  - `CalendarProvider`ï¼šäº¤æ˜“æ—¥å†
  - `InstrumentProvider`ï¼šè‚¡ç¥¨åˆ—è¡¨
  - `FeatureProvider`ï¼šç‰¹å¾æ•°æ®
  - `ExpressionProvider`ï¼šè¡¨è¾¾å¼æ•°æ®
  - `DatasetProvider`ï¼šæ•°æ®é›†æä¾›

### åˆå§‹åŒ–æµç¨‹
```python
from qlib.data import D

# è·å–è‚¡ç¥¨åˆ—è¡¨
instruments = D.instruments('csi300')

# è·å–ç‰¹å¾æ•°æ®
features = D.features(instruments, ['close', 'volume'], start_time, end_time)

# è·å–äº¤æ˜“æ—¥å†
calendar = D.calendar(start_time, end_time)
```

## å¯¹å¤–æ¥å£

### æ ¸å¿ƒæ•°æ®æ¥å£
```python
# è·å–è‚¡ç¥¨åˆ—è¡¨
D.instruments(market='csi300')  # æ”¯æŒå¤šä¸ªå¸‚åœº

# è·å–ç‰¹å¾æ•°æ®
D.features(instruments, fields, freq='day')

# è·å–äº¤æ˜“æ—¥å†
D.calendar(freq='day')

# è¡¨è¾¾å¼è®¡ç®—
D.expression(instruments, expression, start_time, end_time)
```

### æ•°æ®æä¾›è€…ç±»å‹
- **LocalProvider**ï¼šæœ¬åœ°æ–‡ä»¶æ•°æ®
- **ClientProvider**ï¼šè¿œç¨‹å®¢æˆ·ç«¯æ•°æ®
- **HybridProvider**ï¼šæ··åˆæ•°æ®æº

## å…³é”®ä¾èµ–ä¸é…ç½®

### æ•°æ®æºé…ç½®
- **`provider_uri`**ï¼šæ•°æ®å­˜å‚¨è·¯å¾„
- **`freq`**ï¼šæ•°æ®é¢‘ç‡ï¼ˆday, 1min, 5minç­‰ï¼‰
- **`region`**ï¼šå¸‚åœºåŒºåŸŸï¼ˆCN, USç­‰ï¼‰

### ç¼“å­˜é…ç½®
- **å†…å­˜ç¼“å­˜**ï¼šå¿«é€Ÿè®¿é—®çƒ­ç‚¹æ•°æ®
- **ç£ç›˜ç¼“å­˜**ï¼šæŒä¹…åŒ–ç¼“å­˜
- **è¡¨è¾¾å¼ç¼“å­˜**ï¼šè®¡ç®—ç»“æœç¼“å­˜

## æ•°æ®æ¨¡å‹

### æ•°æ®æ ¼å¼
- **DataFrame**ï¼šæ ‡å‡† Pandas æ•°æ®æ ¼å¼
- **MultiIndex**ï¼šæ—¶é—´å’Œè‚¡ç¥¨çš„å¤šçº§ç´¢å¼•
- **Panel**ï¼šä¸‰ç»´æ•°æ®ç»“æ„ï¼ˆå·²å¼ƒç”¨ï¼‰

### æ•°æ®å­—æ®µ
- **åŸºç¡€å­—æ®µ**ï¼šopen, high, low, close, volume
- **æŠ€æœ¯æŒ‡æ ‡**ï¼šMA, RSI, MACDç­‰
- **åŸºæœ¬é¢æ•°æ®**ï¼šè´¢åŠ¡æŒ‡æ ‡ã€è¡Œä¸šåˆ†ç±»
- **è‡ªå®šä¹‰å­—æ®µ**ï¼šé€šè¿‡æ“ä½œç¬¦è®¡ç®—

## æµ‹è¯•ä¸è´¨é‡

### æ•°æ®è´¨é‡æ£€æŸ¥
- **å®Œæ•´æ€§æ£€æŸ¥**ï¼šç¼ºå¤±å€¼æ£€æµ‹
- **ä¸€è‡´æ€§æ£€æŸ¥**ï¼šæ•°æ®èŒƒå›´éªŒè¯
- **æ—¶æ•ˆæ€§æ£€æŸ¥**ï¼šæ•°æ®æ›´æ–°éªŒè¯

### æ€§èƒ½ä¼˜åŒ–
- **å‘é‡åŒ–æ“ä½œ**ï¼šæ‰¹é‡æ•°æ®å¤„ç†
- **ç¼“å­˜æœºåˆ¶**ï¼šå‡å°‘é‡å¤è®¡ç®—
- **å¹¶è¡Œå¤„ç†**ï¼šå¤šè¿›ç¨‹æ•°æ®åŠ è½½

## å¸¸è§é—®é¢˜ (FAQ)

### Q1: å¦‚ä½•é…ç½®æ•°æ®æºï¼Ÿ
```python
qlib.init(
    provider_uri="~/.qlib/qlib_data/cn_data",
    default_conf="client"
)
```

### Q2: å¦‚ä½•è·å–ç‰¹å®šæ—¶é—´èŒƒå›´çš„æ•°æ®ï¼Ÿ
```python
from qlib.data import D

features = D.features(
    instruments=['000001.SZ', '000002.SZ'],
    fields=['close', 'volume'],
    start_time='2020-01-01',
    end_time='2020-12-31'
)
```

### Q3: å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰è¡¨è¾¾å¼ï¼Ÿ
```python
# è®¡ç®—æ”¶ç›Šç‡
returns = D.expression(
    instruments=instruments,
    expression='Ref(close, -1) / close - 1',
    start_time=start_time,
    end_time=end_time
)
```

## ç›¸å…³æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒæ–‡ä»¶
- `__init__.py` - æ¨¡å—å¯¼å‡ºæ¥å£
- `base.py` - åŸºç¡€æŠ½è±¡ç±»å®šä¹‰
- `data.py` - æ•°æ®æä¾›è€…å…·ä½“å®ç°
- `cache.py` - ç¼“å­˜ç³»ç»Ÿå®ç°
- `ops.py` - æ•°æ®æ“ä½œç¬¦å®šä¹‰
- `client.py` - å®¢æˆ·ç«¯æ•°æ®è®¿é—®
- `pit.py` - ç‚¹å¯¹ç‚¹æ•°æ®å¤„ç†

### é…ç½®æ–‡ä»¶
- `filter.py` - æ•°æ®è¿‡æ»¤å™¨
- `inst_processor.py` - å®ä¾‹å¤„ç†å™¨

## å˜æ›´è®°å½• (Changelog)

### 2025-11-17 12:30:16
- âœ¨ åˆ›å»ºæ•°æ®å±‚æ¨¡å—æ–‡æ¡£
- ğŸ“Š å®Œæˆæ•°æ®æ¥å£åˆ†æ
- ğŸ”— å»ºç«‹æ•°æ®æµæ¶æ„å›¾
- ğŸ“ è¡¥å……æ•°æ®ä½¿ç”¨ç¤ºä¾‹

<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

*No recent activity*
</claude-mem-context>