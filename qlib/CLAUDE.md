[æ ¹ç›®å½•](../../CLAUDE.md) > **qlib**

# Qlib æ ¸å¿ƒæ¨¡å—

> Qlib çš„æ ¸å¿ƒåŠŸèƒ½å®ç°ï¼ŒåŒ…å«æ•°æ®å¤„ç†ã€æ¨¡å‹ã€å›æµ‹ã€ç­–ç•¥ç­‰æ ¸å¿ƒç»„ä»¶ã€‚

## æ¨¡å—èŒè´£

Qlib æ ¸å¿ƒæ¨¡å—æä¾›é‡åŒ–æŠ•èµ„çš„åŸºç¡€è®¾æ–½ï¼š
- ç»Ÿä¸€çš„æ•°æ®è®¿é—®æ¥å£
- å¯æ‰©å±•çš„æœºå™¨å­¦ä¹ æ¨¡å‹æ¡†æ¶
- é«˜æ€§èƒ½å›æµ‹å¼•æ“
- çµæ´»çš„ç­–ç•¥æ‰§è¡Œç³»ç»Ÿ

## å­æ¨¡å—ç»“æ„

```mermaid
graph TD
    A["qlib æ ¸å¿ƒæ¨¡å—"] --> B["data æ•°æ®å±‚"];
    A --> C["model æ¨¡å‹å±‚"];
    A --> D["backtest å›æµ‹å¼•æ“"];
    A --> E["strategy ç­–ç•¥æ¡†æ¶"];
    A --> F["contrib æ‰©å±•æ¨¡å—"];
    A --> G["cli å‘½ä»¤è¡Œå·¥å…·"];
    A --> H["é…ç½®ä¸åŸºç¡€è®¾æ–½"];

    B --> B1["base.py - åŸºç¡€æ¥å£"];
    B --> B2["data.py - æ•°æ®å®ç°"];
    B --> B3["cache.py - ç¼“å­˜ç³»ç»Ÿ"];
    B --> B4["ops.py - æ“ä½œç¬¦"];
    B --> B5["client.py - å®¢æˆ·ç«¯"];
    B --> B6["pit.py - ç‚¹å¯¹ç‚¹æ•°æ®"];

    C --> C1["base.py - æ¨¡å‹åŸºç±»"];
    C --> C2["trainer.py - è®­ç»ƒå™¨"];
    C --> C3["utils.py - å·¥å…·å‡½æ•°"];

    D --> D1["backtest.py - å›æµ‹æ ¸å¿ƒ"];
    D --> D2["executor.py - æ‰§è¡Œå™¨"];
    D --> D3["exchange.py - äº¤æ˜“æ‰€"];
    D --> D4["account.py - è´¦æˆ·"];
    D --> D5["position.py - æŒä»“"];
    D --> D6["decision.py - å†³ç­–"];

    E --> E1["base.py - ç­–ç•¥åŸºç±»"];

    F --> F1["data - æ•°æ®æ‰©å±•"];
    F --> F2["model - æ¨¡å‹æ‰©å±•"];
    F --> F3["strategy - ç­–ç•¥æ‰©å±•"];
    F --> F4["report - æŠ¥å‘Šåˆ†æ"];
    F --> F5["online - åœ¨çº¿æœåŠ¡"];
    F --> F6["meta - å…ƒå­¦ä¹ "];

    H --> H1["config.py - é…ç½®ç®¡ç†"];
    H --> H2["constant.py - å¸¸é‡å®šä¹‰"];
    H --> H3["log.py - æ—¥å¿—ç³»ç»Ÿ"];
    H --> H4["typehint.py - ç±»å‹æç¤º"];

    click B "./data/CLAUDE.md" "æŸ¥çœ‹æ•°æ®å±‚æ–‡æ¡£"
    click C "./model/CLAUDE.md" "æŸ¥çœ‹æ¨¡å‹å±‚æ–‡æ¡£"
    click D "./backtest/CLAUDE.md" "æŸ¥çœ‹å›æµ‹å¼•æ“æ–‡æ¡£"
    click E "./strategy/CLAUDE.md" "æŸ¥çœ‹ç­–ç•¥æ¡†æ¶æ–‡æ¡£"
    click F "./contrib/CLAUDE.md" "æŸ¥çœ‹æ‰©å±•æ¨¡å—æ–‡æ¡£"
    click G "./cli/CLAUDE.md" "æŸ¥çœ‹å‘½ä»¤è¡Œå·¥å…·æ–‡æ¡£"
```

## å…¥å£ä¸å¯åŠ¨

### ä¸»å…¥å£ç‚¹
- **`__init__.py`**ï¼šæ¡†æ¶åˆå§‹åŒ–æ¥å£ï¼Œæä¾› `qlib.init()` å‡½æ•°
- **åˆå§‹åŒ–æµç¨‹**ï¼šé…ç½®åŠ è½½ â†’ æ•°æ®æºæŒ‚è½½ â†’ ç»„ä»¶æ³¨å†Œ

### å…³é”®åˆå§‹åŒ–å‚æ•°
```python
qlib.init(
    provider_uri="~/.qlib/qlib_data/cn_data",  # æ•°æ®è·¯å¾„
    default_conf="client",                     # é…ç½®æ¨¡å¼
    logging_level="INFO"                       # æ—¥å¿—çº§åˆ«
)
```

## å¯¹å¤–æ¥å£

### æ•°æ®è®¿é—®æ¥å£
- **`D` å¯¹è±¡**ï¼šç»Ÿä¸€æ•°æ®è®¿é—®å…¥å£
  - `D.features()`ï¼šè·å–ç‰¹å¾æ•°æ®
  - `D.instruments()`ï¼šè·å–è‚¡ç¥¨åˆ—è¡¨
  - `D.calendar()`ï¼šè·å–äº¤æ˜“æ—¥å†

### å›æµ‹æ¥å£
- **`backtest()`**ï¼šå®Œæ•´å›æµ‹æ‰§è¡Œ
- **`get_exchange()`**ï¼šäº¤æ˜“æ‰€é…ç½®
- **`get_strategy_executor()`**ï¼šç­–ç•¥æ‰§è¡Œå™¨

### é…ç½®æ¥å£
- **`C` å¯¹è±¡**ï¼šå…¨å±€é…ç½®ç®¡ç†
- **`QSETTINGS`**ï¼šç¯å¢ƒå˜é‡é…ç½®

## å…³é”®ä¾èµ–ä¸é…ç½®

### æ ¸å¿ƒä¾èµ–
- **pandas >= 1.1**ï¼šæ•°æ®å¤„ç†
- **numpy**ï¼šæ•°å€¼è®¡ç®—
- **mlflow**ï¼šå®éªŒç®¡ç†
- **lightgbm**ï¼šæ¢¯åº¦æå‡æ¨¡å‹
- **fire**ï¼šå‘½ä»¤è¡Œå·¥å…·

### é…ç½®ç³»ç»Ÿ
- **`config.py`**ï¼šé…ç½®ç®¡ç†æ ¸å¿ƒ
- **`pyproject.toml`**ï¼šé¡¹ç›®ä¾èµ–å®šä¹‰
- **ç¯å¢ƒå˜é‡**ï¼š`QLIB_` å‰ç¼€é…ç½®

## æ•°æ®æ¨¡å‹

### æ•°æ®æä¾›è€…æ¶æ„
- **LocalProvider**ï¼šæœ¬åœ°æ•°æ®è®¿é—®
- **ClientProvider**ï¼šå®¢æˆ·ç«¯æ•°æ®è®¿é—®
- **BaseProvider**ï¼šç»Ÿä¸€æŠ½è±¡æ¥å£

### ç¼“å­˜ç³»ç»Ÿ
- **ExpressionCache**ï¼šè¡¨è¾¾å¼ç¼“å­˜
- **DatasetCache**ï¼šæ•°æ®é›†ç¼“å­˜
- **MemoryCache**ï¼šå†…å­˜ç¼“å­˜

## æµ‹è¯•ä¸è´¨é‡

### æµ‹è¯•è¦†ç›–
- å•å…ƒæµ‹è¯•ï¼šå„æ¨¡å—æ ¸å¿ƒåŠŸèƒ½
- é›†æˆæµ‹è¯•ï¼šå®Œæ•´å·¥ä½œæµéªŒè¯
- æ€§èƒ½æµ‹è¯•ï¼šå¤§æ•°æ®é‡å¤„ç†

### è´¨é‡å·¥å…·
- **ç±»å‹æç¤º**ï¼š`typehint.py` ç±»å‹å®šä¹‰
- **æ—¥å¿—ç³»ç»Ÿ**ï¼š`log.py` ç»Ÿä¸€æ—¥å¿—
- **å¼‚å¸¸å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶

## å¸¸è§é—®é¢˜ (FAQ)

### Q1: å¦‚ä½•åˆå§‹åŒ– Qlibï¼Ÿ
```python
import qlib
qlib.init(provider_uri="your_data_path")
```

### Q2: å¦‚ä½•è·å–è‚¡ç¥¨æ•°æ®ï¼Ÿ
```python
from qlib.data import D
instruments = D.instruments('csi300')
features = D.features(instruments, ['close', 'volume'])
```

### Q3: å¦‚ä½•è¿è¡Œå›æµ‹ï¼Ÿ
```python
from qlib.backtest import backtest
portfolio_metrics, indicator_metrics = backtest(
    start_time='2020-01-01',
    end_time='2020-12-31',
    strategy=your_strategy,
    executor=your_executor
)
```

## ç›¸å…³æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒæ–‡ä»¶
- `__init__.py` - æ¡†æ¶å…¥å£
- `config.py` - é…ç½®ç®¡ç†
- `constant.py` - å¸¸é‡å®šä¹‰
- `log.py` - æ—¥å¿—ç³»ç»Ÿ
- `typehint.py` - ç±»å‹æç¤º

### å­æ¨¡å—å…¥å£
- `data/__init__.py` - æ•°æ®å±‚å¯¼å‡º
- `model/__init__.py` - æ¨¡å‹å±‚å¯¼å‡º
- `backtest/__init__.py` - å›æµ‹å¯¼å‡º
- `strategy/__init__.py` - ç­–ç•¥å¯¼å‡º
- `contrib/__init__.py` - æ‰©å±•æ¨¡å—å¯¼å‡º

## å˜æ›´è®°å½• (Changelog)

### 2025-11-17 12:30:16
- âœ¨ åˆ›å»º qlib æ ¸å¿ƒæ¨¡å—æ–‡æ¡£
- ğŸ“Š å®Œæˆå­æ¨¡å—ç»“æ„åˆ†æ
- ğŸ”— å»ºç«‹ Mermaid å¯¼èˆªå›¾
- ğŸ“ è¡¥å……å…³é”®æ¥å£ä¸ä½¿ç”¨è¯´æ˜